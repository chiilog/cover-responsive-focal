Cover Responsive Focal

Markdown briefing for Kiro – use this as the initial context for AI-assisted coding of the WordPress plugin that extends the core Cover block with breakpoint-specific focal points.

⸻

1. Project Overview
	•	Purpose  Transform the standard Gutenberg Cover block so that a single background image can expose different object-position values per breakpoint, keeping the subject visible on desktop, tablet, and mobile.
	•	Outcome  A lightweight, production-ready plugin released under GPL-2.0-or-later. Slug: cover-responsive-focal.

2. Key Features

#	Feature	Notes
1	responsiveFocal attribute	array of objects – each item holds media (string), x (0-1), y (0-1).
2	Inspector UI	Sidebar repeater: breakpoint selector + FocalPointPicker. PC & SP presets created by default.
3	Dynamic <style> injection	render_block filter outputs per-block <style> setting CSS variables --fp-x/--fp-y inside each media query.
4	Single <img> rendering	Re-uses the Cover block’s <img>; no extra markup, no layout shift.
5	Backward compatibility	Works as normal when responsiveFocal is empty – falls back to core focalPoint.

3. Tech Stack & Tooling
	•	WordPress 6.5+ (Block Themes OK).
	•	@wordpress/scripts – build ESNext → ES5 via Babel.
	•	React 18 / Gutenberg Packages (@wordpress/block-editor, @wordpress/components, …).
	•	PHP 7.4+ for plugin bootstrap & server-side rendering.
	•	SCSS compiled to CSS (optional – vanilla CSS acceptable).

4. Directory Structure (proposed)

cover-responsive-focal/
├── build/                 # compiled JS/CSS
├── src/
│   ├── index.js           # `registerBlockType` filter & extension entry
│   ├── inspector.js       # Responsive Focal repeater UI
│   ├── save.js            # overrides Cover save element
│   └── style.scss         # shared CSS (object-position vars)
├── plugin.php             # plugin header + render_block filter
├── package.json
├── composer.json          # (optional) autoload if needed
└── readme.txt             # wp.org format

5. Attribute Schema

responsiveFocal: {
  type: 'array',
  default: [], // [{ media:'(max-width:767px)', x:0.60, y:0.40 }, …]
},

Default core attributes (url, id, focalPoint, …) stay untouched.

6. JavaScript Outline

// index.js
import { addFilter } from '@wordpress/hooks';
import { registerResponsiveFocal } from './inspector';

addFilter(
  'blocks.registerBlockType',
  'crf/extend-cover',
  ( settings, name ) => {
    if ( name !== 'core/cover' ) return settings;
    settings.attributes.responsiveFocal = { type: 'array', default: [] };
    return settings;
  }
);

	•	Detailed code for InspectorControls repeater and save.js to be generated by Kiro (see tasks).

7. PHP Outline

// plugin.php
/*
Plugin Name: Cover Responsive Focal
Description: Adds breakpoint-specific focal points to the Gutenberg Cover block.
Version: 0.1.0
License: GPL-2.0-or-later
*/

add_filter( 'render_block', 'crf_render_block', 10, 2 );
function crf_render_block( $content, $block ) {
    if ( 'core/cover' !== $block['blockName'] ) return $content;
    $attrs = $block['attrs'];
    if ( empty( $attrs['responsiveFocal'] ) ) return $content;
    $id = sanitize_key( $attrs['dataFpId'] ?? wp_unique_id( 'crf-' ) );
    $rules = '';
    foreach ( $attrs['responsiveFocal'] as $row ) {
        $rules .= sprintf( '@media %s{[data-fp-id="%s"]{--fp-x:%s%%;--fp-y:%s%%;}}',
            $row['media'], $id, $row['x']*100, $row['y']*100 );
    }
    return $content . "<style id=\"$id\">$rules</style>";
}

8. CSS Snippet

.wp-block-cover__image-background {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: var(--fp-x, 50%) var(--fp-y, 50%);
}

9. Tasks for Kiro
	1.	Scaffold plugin files per directory map.
	2.	Implement blocks.registerBlockType filter with new attribute.
	3.	Build InspectorControls repeater UI (React):
	•	Add row → choose breakpoint (select presets or free text) & focal picker.
	•	Delete / reorder rows.
	4.	Override save element to write data-fp-id+inline vars.
	5.	Complete PHP render filter exactly as outlined.
	6.	Add basic SCSS → compile.
	7.	Ensure plugin passes wp-scripts lint-js & wp-env start smoke test.
	8.	Generate README.md with installation & usage.

10. Acceptance Criteria
	•	Works on WP 6.5 block & classic themes.
	•	No visual regressions when responsiveFocal is empty.
	•	CLS ≤ 0.1, LCP < 2.5 s on mobile (lab metrics).
	•	Coding standards: @wordpress/eslint-plugin/recommended & PHPCS WordPress-Core.

11. Next Steps / Roadmap
	•	v0.2: UI preset for desktop/tablet/mobile seeds automatically.
	•	v0.3: Optional server-side smartcrop fallback (OpenCV / Imagick) when no focal provided.
	•	v1.0: Submit to WP.org, internationalize strings, add CI via GitHub Actions.

⸻

End of brief